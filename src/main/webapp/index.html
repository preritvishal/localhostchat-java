<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>localhost:chat</title>

	<style type="text/css">
		body {
			background-color: black;
		}

		body * {
			margin: 5px;
		}

		p,
		pre {
			padding: 7px;
			border-radius: 15px;
			font-size: medium;
			color: white;
			background: rgb(20, 20, 20);
		}

		pre {
			white-space: pre-wrap;
			font-family: monospace;
			overflow-wrap: break-word;
		}

		#main-div {
			display: flex;
			height: 98vh;
			flex-direction: row;

		}

		#inner-main-div {
			flex-direction: column;
			flex: 8;
			display: flex;
		}

		#inner-side-div {
			flex: 2;
			flex-direction: column;
			background: rgb(20, 20, 20);
			border-radius: 20px;
			margin-bottom: 20px;
		}

		.options-div {
			color: white;
			font-family: monospace;
			display: flex;
			font-size: medium;

		}

		.options-div > label {
			margin-right: 20px;
			flex-direction: row;
			display: inline;
		}

		#previous-text-div {
			flex: 9;
			overflow-y: auto;
		}

		#previous-text-div::-webkit-scrollbar {
			width: 5px;
			height: 5px;
		}

		#previous-text-div::-webkit-scrollbar-track {
			background-color: #F5F5F5;
		}

		#previous-text-div::-webkit-scrollbar-thumb {
			background-color: #ccc;
			border-radius: 5px;
		}

		#previous-text-div::-webkit-scrollbar-thumb:hover {
			background-color: #bbb;
		}

		#chat-from {
			display: flex;
		}

		#message-input {
			flex: 1;
			width: 100%;
			box-sizing: border-box;
			background: rgb(32, 32, 32);
			outline: none;
			border: 0;
			color: rgb(255, 255, 255);
			height: 2.8em;
			padding: 15px;
			border-radius: 20px;
			font-size: medium;
		}
	</style>

	<script>
// 		function scrollToBottom() {
// 			const messageList = document.getElementById("previous-text-div");
// 			messageList.scrollTop = messageList.scrollHeight;
// 		}


// 		function getMessages() {	// original
// 			scrollToBottom();
// 			fetch("./chat") // Replace with your servlet URL
// 				.then(response => response.json())
// 				.then(data => {
// 					const messageList = document.getElementById("previous-text-div");
// 					messageList.innerHTML = ""; // Clear existing messages

// 					data.forEach(message => {
// 						const messageElement = document.createElement("pre");
// 						messageElement.textContent = JSON.stringify(message, null, 4);
// 						messageList.appendChild(messageElement);
// 					});

// 				})
// 				.catch(error => {
// 					console.error("Error fetching messages:", error);
// 				});
// 		}

// 		window.onload = function () {
// 			const messageInput = document.getElementById("message-input");
// 			messageInput.focus();
// 			getMessages();
// 			scrollToBottom();
// 		};

// 		setInterval(getMessages, 500);	// repeating it every half second to keep it updated!

	</script>

</head>

<body>
	<div id="main-div">
		<div id="inner-main-div">
			<div id="previous-text-div"> </div>
			<div id="text-input-div">
				<form method="post" action="chat" id="chat-form" autocomplete="off">
					<input type="text" name="message" id="message-input" placeholder="Enter dummy data..."
						autocomplete="off">
					<!-- 					<textarea name="message" id="message-input" placeholder="Enter dummy data..." -->
					<!-- 					autocomplete="off" form="chat-form"></textarea> -->
				</form>
			</div>
		</div>
		<div id="inner-side-div">
			<div class="options-div">
				<label for="json-text-toggle">
					<input type="radio" name="json-xml-plain-text-toggle" id="json-xml-plain-text-toggle" class="json-xml-text-button-class" checked>
					json
				</label>
				<!-- xml support coming soon -->
				<label for="json-text-toggle">
					<input type="radio" name="json-xml-plain-text-toggle" id="json-xml-plain-text-toggle" class="json-xml-text-button-class">
					xml
				</label>
				<label for="json-text-toggle">
					<input type="radio" name="json-xml-plain-text-toggle" id="json-xml-plain-text-toggle" class="json-xml-text-button-class">
					plain text
				</label>
			</div>
		</div>
	</div>
	
	<script>
	const wsUri = "wss://localhost:8080/localhostchat/chatsocket"; // Replace with your actual endpoint path
	const messageInput = document.getElementById("message-input");
	const previousTextDiv = document.getElementById("previous-text-div");

	function sendMessage() {
	  const message = messageInput.value.trim();
	  if (!message) {
	    return; // Avoid sending empty messages
	  }

	  const socket = new WebSocket(wsUri);

	  socket.onopen = function(event) {
	    console.log("Connected to WebSocket server!");
	    socket.send(message); // Send the message after connection is established
	    messageInput.value = ""; // Clear the input field after sending
	  };

	  socket.onmessage = function(event) {
	    const receivedMessage = event.data;
	    previousTextDiv.textContent += receivedMessage + "\n"; // Update previous text div with new line
	  };

	  socket.onerror = function(error) {
	    console.error("WebSocket error:", error);
	  };
	}

	document.getElementById("chat-form").addEventListener("submit", function(event) {
	  event.preventDefault(); // Prevent default form submission behavior
	  sendMessage();
	});
	</script>
	
</body>

</html>